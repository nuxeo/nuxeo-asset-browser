<?xml version="1.0" encoding="UTF-8"?>
<component name="org.nuxeo.dam.layouts">

  <require>org.nuxeo.ecm.webapp.seam.debug.action</require>
  <require>org.nuxeo.ecm.platform.preview.actions</require>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="widgettypes">
    <widgetType name="dam_title">
      <configuration>
        <sinceVersion>5.7</sinceVersion>
        <title>Title</title>
        <description>
          <p>
            This widget type displays the title of a document.
          </p>
          <p>
            It requires the following fields configuration:
            <ul>
              <li>
                first field maps the document model, it will be used to
                display the title
              </li>
            </ul>
          </p>
        </description>
      </configuration>
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      <property name="template">
        /dam/widgets/title_widget_template.xhtml
      </property>
    </widgetType>

    <widgetType name="damAssetViewNoDocument">
      <configuration>
        <sinceVersion>5.7</sinceVersion>
        <title>No Document selected</title>
        <description>
          <p>
            This widget type displays a placeholder when no document is selected.
          </p>
        </description>
      </configuration>
      <handler-class>
        org.nuxeo.ecm.platform.forms.layout.facelets.plugins.TemplateWidgetTypeHandler
      </handler-class>
      <property name="template">
        /dam/widgets/dam_asset_view_no_document.xhtml
      </property>
    </widgetType>
  </extension>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="widgets">

    <!-- Grid layout widgets -->
    <widget name="damPanelLeft" type="currentDocumentActionsWithForms">
      <properties widgetMode="view">
        <property name="category">DAM_PANEL_LEFT</property>
      </properties>
    </widget>

    <widget name="damPanelCenter" type="currentDocumentActions">
      <properties widgetMode="view">
        <property name="category">DAM_PANEL_CENTER</property>
      </properties>
      <controls mode="any">
        <control name="requireSurroundingForm">false</control>
      </controls>
    </widget>

    <widget name="damPanelRight" type="currentDocumentActions">
      <properties widgetMode="view">
        <property name="category">DAM_PANEL_RIGHT</property>
      </properties>
      <controls mode="any">
        <control name="requireSurroundingForm">false</control>
      </controls>
    </widget>

    <!-- Search -->
    <widget name="damSearchesSelector" type="template">
      <properties widgetMode="any">
        <property name="template">/dam/widgets/dam_searches_selector_widget_template.xhtml</property>
      </properties>
    </widget>

    <widget name="damSearchFilters" type="template">
      <properties widgetMode="any">
        <property name="template">/dam/widgets/dam_search_filters_widget_template.xhtml</property>
      </properties>
    </widget>

    <widget name="damSearchActions" type="template">
      <properties widgetMode="any">
        <property name="template">/dam/widgets/dam_search_actions_widget_template.xhtml</property>
      </properties>
    </widget>

    <!-- Search results -->
    <widget name="damNewAsset" type="template">
      <properties widgetMode="any">
        <property name="template">/dam/widgets/dam_new_asset_widget_template.xhtml</property>
      </properties>
    </widget>

    <widget name="damSearchResults" type="template">
      <properties widgetMode="any">
        <property name="template">/dam/widgets/dam_search_results_widget_template.xhtml</property>
      </properties>
    </widget>

    <!-- Asset view -->
    <widget name="damAssetViewNoDocument" type="damAssetViewNoDocument">
      <labels>
        <label mode="any"></label>
      </labels>
      <translated>false</translated>
    </widget>


    <widget name="damAssetViewActions" type="currentDocumentActionsWithForms">
      <properties widgetMode="view">
        <property name="category">DAM_ASSET_VIEW_ACTIONS</property>
        <property name="styleClass">globalActionBar</property>
        <property name="subStyleClass">contextActions</property>
        <property name="overallDisplay">horizontal_block</property>
        <property name="actionStyleClass">button</property>
        <property name="actionsDisplay">icons</property>
        <property name="ignoreTemplateProperty">true</property>
        <property name="maxActionsNumber">7</property>
      </properties>
    </widget>

    <widget name="damAssetViewTitle" type="dam_title">
      <labels>
        <label mode="any"></label>
      </labels>
      <translated>false</translated>
      <fields>
        <field></field>
        <field>dc:description</field>
      </fields>
    </widget>

    <widget name="damAssetViewPicture" type="picture_view">
      <properties widgetMode="any">
        <property name="pictureView">Medium</property>
      </properties>
    </widget>

    <widget name="damAssetViewVideo" type="video_player">
      <properties widgetMode="any">
        <property name="width">425</property>
        <property name="height">235</property>
      </properties>
    </widget>

    <widget name="damAssetViewDescription" type="summary_current_document_description" />

    <widget name="damAssetViewStates" type="summary_current_document_states">
      <controls mode="any">
        <control name="handlingLabels">false</control>
      </controls>
    </widget>

    <widget name="damAssetViewLikeStatus" type="summary_document_like_status" />

    <widget name="damAssetViewVideoStoryboard" type="container">
      <labels>
        <label mode="any">heading.storyboard</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <subWidgets>
        <widget name="videoStoryboard" type="video_storyboard">
          <labels>
            <label mode="any"></label>
          </labels>
          <translated>false</translated>
        </widget>
      </subWidgets>
      <properties widgetMode="any">
        <property name="foldable">true</property>
      </properties>
    </widget>

    <widget name="damAssetViewVideoInfo" type="container">
      <labels>
        <label mode="any">label.dam.video.information</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <subWidgets>
        <widget name="videoInfo" type="layout">
          <labels>
            <label mode="any"></label>
          </labels>
          <translated>false</translated>
          <properties widgetMode="any">
            <property name="name">video_info</property>
          </properties>
        </widget>
      </subWidgets>
      <properties widgetMode="any">
        <property name="foldable">true</property>
        <property name="hideSubLabels">true</property>
      </properties>
    </widget>

    <widget name="damAssetViewAudio" type="audio_player">
      <fields>
        <field>file:content</field>
      </fields>
    </widget>

    <widget name="damAssetViewDamCommon" type="toggleableLayoutWithForms">
      <labels>
        <label mode="any">label.dam.common</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <properties widgetMode="any">
        <property name="displayToggleActionInHeader">true</property>
        <property name="foldable">true</property>
        <property name="initialLayoutName">dam_common</property>
        <property name="useAjaxForm">true</property>
      </properties>
    </widget>

    <widget name="damAssetViewWorkflow" type="container">
      <labels>
        <label mode="any">label.route.info</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <subWidgets>
        <widget name="assetWorkflow" type="summary_document_route">
          <controls mode="any">
            <control name="requireSurroundingForm">true</control>
            <control name="handlingLabels">false</control>
          </controls>
        </widget>
      </subWidgets>
      <properties widgetMode="any">
        <property name="foldable">true</property>
        <property name="foldedByDefault">true</property>
        <property name="hideSubLabels">true</property>
      </properties>
    </widget>

    <widget name="damAssetViewTasks" type="container">
      <labels>
        <label mode="any">label.document.routing.your.tasks</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <subWidgets>
        <widget name="assetTasks" type="summary_current_document_single_tasks">
          <controls mode="any">
            <control name="requireSurroundingForm">true</control>
            <control name="handlingLabels">false</control>
          </controls>
        </widget>
      </subWidgets>
      <properties widgetMode="any">
        <property name="foldable">true</property>
        <property name="foldedByDefault">true</property>
        <property name="hideSubLabels">true</property>
      </properties>
    </widget>

    <widget name="damAssetViewDublincore" type="toggleableLayoutWithForms">
      <labels>
        <label mode="any">label.schema.dublincore</label>
      </labels>
      <translated>true</translated>
      <handlingLabels>true</handlingLabels>
      <properties widgetMode="any">
        <property name="displayToggleActionInHeader">true</property>
        <property name="foldable">true</property>
        <property name="foldedByDefault">true</property>
        <property name="initialLayoutName">dublincore</property>
        <property name="useAjaxForm">true</property>
      </properties>
    </widget>

    <widget name="damc_author" type="text">
      <labels>
        <label mode="any">label.dam.damc.author</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>damc:author</field>
      </fields>
      <properties widgetMode="edit">
        <property name="styleClass">dataInputText</property>
      </properties>
    </widget>

    <widget name="damc_authoringDate" type="datetime">
      <labels>
        <label mode="any">label.dam.damc.authoringDate</label>
      </labels>
      <translated>true</translated>
      <fields>
        <field>damc:authoringDate</field>
      </fields>
      <properties widgetMode="view">
        <property name="pattern">#{nxu:basicDateFormater()}</property>
      </properties>
      <properties widgetMode="edit">
        <property name="format">#{nxu:basicDateFormater()}</property>
        <property name="styleClass">dataInputTextDate</property>
      </properties>
    </widget>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

    <action id="damSearchesSelector" type="widget" order="100">
      <category>DAM_PANEL_LEFT</category>
      <properties>
        <property name="widgetName">damSearchesSelector</property>
      </properties>
    </action>

    <action id="damSearchActionsTop" type="widget" order="200">
      <category>DAM_PANEL_LEFT</category>
      <properties>
        <property name="widgetName">damSearchActions</property>
      </properties>
    </action>

    <action id="damSearchFilters" type="widget" order="300">
      <category>DAM_PANEL_LEFT</category>
      <properties>
        <property name="widgetName">damSearchFilters</property>
      </properties>
    </action>

    <action id="damSearchActionsBottom" type="widget" order="400">
      <category>DAM_PANEL_LEFT</category>
      <properties>
        <property name="widgetName">damSearchActions</property>
      </properties>
    </action>

    <action id="damNewAsset" type="widget" order="100">
      <category>DAM_PANEL_CENTER</category>
      <properties>
        <property name="widgetName">damNewAsset</property>
      </properties>
    </action>

    <action id="damSearchResults" type="widget" order="200">
      <category>DAM_PANEL_CENTER</category>
      <properties>
        <property name="widgetName">damSearchResults</property>
      </properties>
    </action>

    <action id="damAssetViewActions" type="widget" order="100">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewActions</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewNoDocument" type="widget" order="200">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewNoDocument</property>
      </properties>
      <filter-id>noCurrentDocument</filter-id>
    </action>

    <action id="damAssetViewTitle" type="widget" order="200">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewTitle</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewPicture" type="widget" order="300">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewPicture</property>
      </properties>
      <filter-id>hasPictureFacet</filter-id>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewVideo" type="widget" order="300">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewVideo</property>
      </properties>
      <filter-id>hasVideoFacet</filter-id>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewAudio" type="widget" order="300">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewAudio</property>
      </properties>
      <filter-id>hasAudioFacet</filter-id>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewDescription" type="widget" order="400">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewDescription</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewStates" type="widget" order="500">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewStates</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewLikeStatus" type="widget" order="600">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewLikeStatus</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewVideoStoryboard" type="widget" order="700">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewVideoStoryboard</property>
      </properties>
      <filter-id>hasVideoFacet</filter-id>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewDamCommon" type="widget" order="800">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewDamCommon</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewVideoInfo" type="widget" order="900">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewVideoInfo</property>
      </properties>
      <filter-id>hasVideoFacet</filter-id>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewWorkflow" type="widget" order="1000">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewWorkflow</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <action id="damAssetViewTasks" type="widget" order="1100">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewTasks</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
      <filter-id>hasTasks</filter-id>
    </action>

    <action id="damAssetViewDublincore" type="widget" order="1200">
      <category>DAM_PANEL_RIGHT</category>
      <properties>
        <property name="widgetName">damAssetViewDublincore</property>
      </properties>
      <filter-id>hasAssetFacet</filter-id>
    </action>

    <!-- Asset view actions-->
    <action id="showFancyBoxPreview">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="documentLock">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="documentUnlock">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="downloadAction">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="subscribesAllDocNotifications">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="unsubscribesAllDocNotifications">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="addCurrentDocumentToWorklist">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="print">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="documentLike">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

    <action id="documentUnlike">
      <category>DAM_ASSET_VIEW_ACTIONS</category>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="noCurrentDocument">
      <rule grant="true">
        <condition>currentDocument == null</condition>
      </rule>
    </filter>

    <filter id="hasAssetFacet">
      <rule grant="true">
        <facet>Asset</facet>
      </rule>
    </filter>

    <filter id="hasTasks">
      <rule grant="true">
        <condition>#{currentDashBoardItemsExceptPublishingTasks.size() > 0}</condition>
      </rule>
    </filter>

    <!-- TODO move those filters to audio and video modules -->
    <filter id="hasVideoFacet">
      <rule grant="true">
        <facet>Video</facet>
      </rule>
    </filter>

    <filter id="hasAudioFacet">
      <rule grant="true">
        <facet>Audio</facet>
      </rule>
    </filter>

  </extension>

  <extension target="org.nuxeo.ecm.platform.forms.layout.WebLayoutManager"
    point="layouts">

    <layout name="gridDamLayout">
      <templates>
        <template mode="any">
          /layouts/layout_grid_template.xhtml
        </template>
      </templates>
      <rows>
        <row>
          <properties mode="any">
            <property name="nxl_gridStyleClass_0">gridStyle2</property>
            <property name="nxl_gridStyleClass_1">gridStyle6</property>
            <property name="nxl_gridStyleClass_2">gridStyle4</property>
          </properties>
          <widget>damPanelLeft</widget>
          <widget>damPanelCenter</widget>
          <widget>damPanelRight</widget>
        </row>
      </rows>
    </layout>

    <layout name="dam_common">
      <templates>
        <template mode="any">/layouts/layout_default_template.xhtml</template>
      </templates>
      <rows>
        <row>
          <widget>damc_author</widget>
        </row>
        <row>
          <widget>damc_authoringDate</widget>
        </row>
      </rows>
    </layout>

  </extension>

</component>
