<c:if test="true"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:a4j="http://richfaces.org/a4j">

  <c:if test="#{not empty damActions.allowedAssetTypes and damActions.canCreateInAssetLibrary}">
    <div class="action_bar">
      <a id="newAssetLink" href="#"
        onclick="initializeNewAssetType(); return false;">
        #{messages['label.dam.new.asset']}
      </a>
    </div>

    <a4j:form>
      <a4j:jsFunction name="initializeNewAssetType" reRender="newAsset_panel"
        action="#{damActions.initializeNewAssetType()}"
        oncomplete="nuxeo.dam.showNewAssetFancyBox();">
      </a4j:jsFunction>
    </a4j:form>
  </c:if>

  <a4j:region>
    <div style="display:none;">
      <div id="newAssetBox">

        <h3><h:outputText value="#{messages['label.dam.new.asset']}" /></h3>

        <div class="content">
          <a4j:outputPanel id="newAsset_panel">

            <c:if test="#{not empty damActions.selectedNewAssetType}">
              <table class="dataInput">
                <tr>
                  <td class="labelColumn">
                    #{messages['label.dam.new.asset.type']}
                  </td>
                  <td class="fieldColumn">
                    <a4j:form>
                      <h:selectOneListbox size="1" value="#{damActions.selectedNewAssetType}"
                        id="#{widget.id}_select">
                        <a4j:support event="onchange" action="#{damActions.selectNewAssetType()}"
                          reRender="newAssetLayout_panel" />
                        <nxu:selectItems value="#{damActions.allowedAssetTypes}"
                          var="type"
                          itemValue="#{type.id}"
                          itemLabel="#{messages[type.label]}" />
                      </h:selectOneListbox>
                    </a4j:form>
                  </td>
                </tr>
              </table>

              <a4j:outputPanel id="newAssetLayout_panel">
                <table class="dataInput fullWidth separator">
                  <tr>
                    <td class="labelColumn"></td>
                    <td class="fieldcolumn">
                      <p class="popUpDescription">
                        #{messages[nxd:typeInfo(changeableDocument).description]}
                      </p>
                    </td>
                  </tr>
                </table>

                <h:form enctype="multipart/form-data" id="#{widget.id}_form">
                  <nxl:documentLayout mode="create" value="#{changeableDocument}" />

                  <p class="buttonsGadget">
                    <nxh:commandButton value="#{messages['command.create']}"
                      action="#{damActions.saveNewAsset()}"
                      styleClass="button" />
                    <a4j:commandButton value="#{messages['command.cancel']}"
                      immediate="true"
                      action="#{damActions.cancelNewAsset()}"
                      oncomplete="jQuery.fancybox.close()"
                      styleClass="button" />
                  </p>
                </h:form>
              </a4j:outputPanel>
            </c:if>
          </a4j:outputPanel>


        </div>

      </div>
    </div>
  </a4j:region>

</c:if>
